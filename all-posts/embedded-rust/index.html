<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/android-chrome-512x512.png rel=android-chrome sizes=512x512><link href=/icons/android-chrome-192x192.png rel=android-chrome sizes=192x192><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/css/main.css rel=stylesheet><link href=# id=syntax_highlight rel=stylesheet><title>
        
        RustyNotes
        
      </title><body class="dark:bg-gray-700 flex flex-col h-screen justify-between"><nav class="bg-gray-200 dark:bg-gray-800" id=navbar><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex items-center justify-between h-16"><div class="flex items-center sm:hidden"><button class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls=mobile-menu aria-expanded=false id=toggle-mobile-menu type=button><span class=sr-only>Open main menu</span>  <svg class="block h-6 w-6" viewbox="0 0 24 24" aria-hidden=true fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M4 6h16M4 12h16M4 18h16" stroke-linecap=round stroke-linejoin=round stroke-width=2 /></svg>  <svg class="hidden h-6 w-6" viewbox="0 0 24 24" aria-hidden=true fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M6 18L18 6M6 6l12 12" stroke-linecap=round stroke-linejoin=round stroke-width=2 /></svg></button></div><div class="flex-1 flex items-center"><div class="flex-shrink-0 flex items-center ml-2"><a class="text-xl text-gray-800 dark:text-white" href=/>RustyNotes</a></div><div class="hidden sm:block sm:ml-6"><div class="nav-links flex space-x-4"><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/>Home</a><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/categories>Categories</a><button id=toggle-sidebar><svg class="w-7 h-7 text-gray-800 dark:text-gray-300" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg></button></div></div><div class="flex ml-auto relative items-center sm:mr-4"><input class="rounded-xl border border-black dark:border-gray-200 h-9 text-black dark:text-gray-200 dark:bg-gray-700 w-24 sm:w-full" id=search><svg class="w-6 h-6 absolute left-2 text-black dark:text-gray-200" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg><span class="absolute right-2 hidden sm:block text-gray-400 text-sm leading-5 py-0.5 px-1.5 border border-gray-300 rounded-md"> <kbd class=font-sans> <abbr class=no-underline title=Command>⌘</abbr> </kbd> <kbd class=font-sans>K</kbd> </span></div><div class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex z-10" id=search-modal><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container text-gray-800 bg-gray-200 dark:bg-gray-800 dark:text-gray-400 w-11/12 md:max-w-md mx-auto rounded-lg shadow-lg z-50 mt-40 sm:mt-32 h-36 border border-2 border-gray-800 dark:border-gray-400"><div class="modal-close absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-white text-sm z-50"><svg class="fill-current text-white" viewbox="0 0 18 18" height=18 width=18 xmlns=http://www.w3.org/2000/svg><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg><span class=text-sm>(Esc)</span></div><div class="py-4 text-left px-6 flex flex-col"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold">Search<div class="modal-close cursor-pointer z-50"><svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M6 18L18 6M6 6l12 12" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg></div></div><input class="rounded-xl border border-black h-12 text-bold text-2xl pl-2 text-black dark:text-gray-200 bg-gray-700" id=search-input><div id=search-results><ul class="flex flex-col justify-center max-h-2xl mt-2 overflow-scroll" id=results-list></ul></div></div></div></div><div class="nav-links -translate-x-full flex flex-col pt-6 p-2 text-2xl text-black dark:text-gray-200 bg-gray-200 dark:bg-gray-900 transform top-0 left-0 w-64 bg-white fixed h-full overflow-auto ease-in-out transition-all duration-300 z-30 shadow-2xl" id=sidebar><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/all-posts>All-posts</a></div><div class="flex p-2 ml-4 relative"><button class="bg-gray-200 text-gray-800 hover:text-gray-900 dark:bg-gray-800 dark:text-gray-400 dark:hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" id=switch-lang type=button><svg class="w-6 h-6 bg-gray-200 text-gray-800 hover:text-gray-900 dark:bg-gray-800 dark:text-gray-400 dark:hover:text-white" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg></button><div class="hidden absolute top-12 -left-1/2 z-10 p-4 rounded-lg divide-y bg-gray-300 dark:bg-gray-800 text-gray-800 dark:text-gray-400 flex flex-col w-28" id=switch-lang-panel><span class=sr-only>Switch Lang</span><a class="flex justify-center py-2 hover:text-gray-800 dark:hover:text-white" href=/>English</a><a class="flex justify-center py-2 hover:text-gray-800 dark:hover:text-white" href=/de>Deutsch</a></div></div><div class="flex p-2"><button class="bg-gray-200 text-gray-800 hover:text-gray-900 dark:bg-gray-800 dark:text-gray-400 dark:hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" id=switch-theme type=button><span class=sr-only>Switch Theme</span>  <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none id=light stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg>  <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none id=dark stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg></button></div></div></div></div><div class="sm:hidden fixed z-10 overflow-hidden" id=mobile-menu><div class="nav-links flex flex-col space-y-4 items-center w-screen dark:bg-gray-800 transition-all ease-out duration-500 h-0"><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/>Home</a><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/categories>Categories</a><a class="text-gray-800 dark:text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" href=/all-posts>All-posts</a></div></div></nav><main class="max-w-7xl mx-auto text-black dark:text-gray-200 w-full mb-auto"><div class=flex><h1 class="text-2xl text-bold my-6 mx-auto">Embedded rust entry</h1></div><div class="flex gap-x-8"><div class="flex flex-col sm:w-3/4 w-full border border-2 border-gray-200 dark:border-black rounded-xl p-5 shadow-2xl bg-gray-200 dark:bg-gray-800"><div class="flex flex-col py-2 justify-center"><p class=text-bold></div><div class="flex flex-wrap py-2"><div class="flex items-center w-1/3"><div class="flex flex-col sm:flex-row sm:space-x-3 text-gray-900 dark:text-gray-400"><span class=flex>  <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=ml-1>7 min</span> </span><span class=flex>  <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=ml-1>1230 words</span> </span></div></div><div class="flex w-2/3 sm:space-x-3 text-gray-900 dark:text-gray-400 justify-end"><span class="flex items-center"> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=ml-1><time datetime=2024-07-19>Published on July 19, 2024</time></span> </span><span class="flex items-center"> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=ml-1>ilhan Ben Martin</span> <img alt="Placeholder text describing the default author's avatar." class="rounded-full h-9 w-9 ml-1" src=/icons/favicon-200x200.png> </span></div></div><div class="flex flex-wrap py-2"><div class=w-2/3><p>Categories: <a class="text-gray-900 dark:text-gray-400 flex py-1 items-center" href=https://rustynotes.com/categories/guides/> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=pl-1>Guides</span> </a></div><div class=w-1/3><p>Tags: <a class="text-gray-900 dark:text-gray-400 flex py-1 items-center" href=https://rustynotes.com/tags/rust/> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=pl-1>Rust</span> </a> <a class="text-gray-900 dark:text-gray-400 flex py-1 items-center" href=https://rustynotes.com/tags/environment/> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=pl-1>Environment</span> </a> <a class="text-gray-900 dark:text-gray-400 flex py-1 items-center" href=https://rustynotes.com/tags/embedded/> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=pl-1>Embedded</span> </a> <a class="text-gray-900 dark:text-gray-400 flex py-1 items-center" href=https://rustynotes.com/tags/guide/> <svg class="w-6 h-6" viewbox="0 0 24 24" fill=none stroke=currentColor xmlns=http://www.w3.org/2000/svg><path d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" stroke-linecap=round stroke-linejoin=round stroke-width=2></path></svg> <span class=pl-1>Guide</span> </a></div></div><div class="text-bold mt-2" id=page-content><hr><br><h2 id=eng-embedded-rust-entry>(<em>Eng</em>) Embedded rust entry</h2><blockquote><p>It is already here. Future is here, i don't want to miss future.</blockquote><blockquote><p>To start we need to install rust on our computer. <a href=https://www.rust-lang.org/tools/install>Install rust from here</a></blockquote><blockquote><p>Then we call <code>rustup update</code> command to get most updated version. Because it gets release every 6 weeks.</blockquote><blockquote><p>Compiler is <code>rustc</code>, package manager is <code>cargo</code>.</blockquote><blockquote><p>We will use <code>vscode</code>, it is not the fastest ide but so easy. Then we will install <code>rust anaylzer</code> for our coding experience.</blockquote><blockquote><p>Rustc compiler is front end of LLVM. Which is making our job possible.</blockquote><blockquote><p>Rust runs on most of microcontroller families. Has a great support in Arm Cortex and Risc 5. We will use devkit. Because they have one extra chip onboard for usb debugging.</blockquote><blockquote><p>Now how we build for this chips? We are going to use power of cross compilation. We will compile and run in our computer. But to compile same code in our device we need compile it again for target. We will define compile target.</blockquote><blockquote><p><code>&LTarch>&LTsub>-&LTvendor>-&LTsys>-&LTenc></code></blockquote><ul><li>arch = x86_64, i386, arm, ...<li>sub = [ex. arm] v5, v6, v7m, ...<li>vendor = [optional] pc, apple, ibm, ...<li>sys = none, linux, win32, darwin, ...<li>env = eabi, gnu, elf, ...</ul><blockquote><p>Then we will add it as target by <code>rustup target add</code></blockquote><blockquote><p>For <code>microbit dev board v2</code>, we have <code>nRF52833</code> with arm cortex m4. When we check from arm website, we see it has <code>Armv7E-M</code> arch. Then we visit Rust platform support page to see target specs. When we search for Armv7E we see target will be <code>thumbv7em-none-eabihf</code> for our development. Our command will be <code>rustup target add thumbv7em-none-eabihf</code>.</blockquote><blockquote><p>By running <code>rustup show</code> we can see our targets.</blockquote><blockquote><p>To create project we run <code>cargo new myDemo</code></blockquote><blockquote><p>It will create the project directory. We can reach by <code>cd mydemo</code></blockquote><blockquote><p>It has <code>Cargo.toml</code> and <code>Cargo.lock</code> files for dependency. And we will have <code>src</code> directory there which has <code>main.rs</code> file and our next future code files.</blockquote><blockquote><p>Cargo will run check in background to control our dependencies.</blockquote><hr><blockquote><p>We will code our application. We will add <code>#![no_std]</code> and <code>#![no_main]</code> for embedded.</blockquote><blockquote><p>To see our code placement in chip memory we need module named <code>cortex-m-rt</code>. We can go to <code>crates.io</code> website and reach all related details. It says</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>    cortex-m-rt
</span><span>
</span><span>    Startup code and minimal runtime for Cortex-M microcontrollers
</span></code></pre><blockquote><p>Has a reference to technical documents for this crate as <code>https://docs.rs/cortex-m-rt/0.7.3/cortex_m_rt/</code> It says:</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>Startup code and minimal runtime for Cortex-M microcontrollers
</span><span>
</span><span>This crate contains all the required parts to build a no_std application (binary crate) that targets a Cortex-M microcontroller.
</span><span>
</span><span>---
</span><span>Features
</span><span>---
</span><span>
</span><span>This crates takes care of:
</span><span>
</span><span>    The memory layout of the program. In particular, it populates the vector table so the device can boot correctly, and properly dispatch exceptions and interrupts.
</span><span>
</span><span>    Initializing static variables before the program entry point.
</span><span>
</span><span>    Enabling the FPU before the program entry point if the target is thumbv7em-none-eabihf.
</span><span>
</span><span>This crate also provides the following attributes:
</span><span>
</span><span>    #[entry] to declare the entry point of the program
</span><span>    #[exception] to override an exception handler. If not overridden all exception handlers default to an infinite loop.
</span><span>    #[pre_init] to run code before static variables are initialized
</span><span>
</span><span>This crate also implements a related attribute called #[interrupt], which allows you to define interrupt handlers
</span><span>
</span></code></pre><blockquote><p>We will add it by <code>cargo add cortex-m-rt</code>. Then we will create a <code>memory.x</code> file in project folder and add specifications below.For the NRF52833 with details found from memory map from datasheet.</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>MEMORY
</span><span>{
</span><span>  FLASH : ORIGIN = 0x00000000, LENGTH = 512K
</span><span>  RAM : ORIGIN = 0x20000000, LENGTH = 128K
</span><span>}
</span></code></pre><blockquote><p>Then we make our main code never return:</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>#![no_std]
</span><span>#![no_main]
</span><span>
</span><span>use cortex_m_tr::entry;
</span><span>
</span><span>#[entry]
</span><span>fn main() -> !{
</span><span>    loop{}
</span><span>}
</span></code></pre><blockquote><p>Now we need to tell to rustc to run our linker whenever it builds. So we create <code>.cargo</code> directory in project. Add our <code>config.toml</code> file like below. (To reach this command: <code>cargo rustc --target thumbv7m-none-eabi -- \ -C link-arg=-nostartfiles -C link-arg=-Tlink.x</code>)</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>[build]
</span><span>target = "thumbv7em-none-eabihf"
</span><span>
</span><span>[target.thumbv7em-none-eabihf]
</span><span>rustflags = ["-C", "link-arg=-Tlink.x]
</span></code></pre><blockquote><p>Remember we said rustc will run the compiler in background to check the code and errors. But by default it is for our computer. We need to change it for our target. We go to <code>.vscode</code> folder and add below lines to <code>settings.json</code>.</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>{
</span><span>    "rust-analyzer.check.allTargets": false,
</span><span>    "rust-analyzer.cargo.target":"thumbv7em-none-eabihf"
</span><span>}
</span></code></pre><blockquote><p>Our project will ask for panic handler when we try to build our bare metal empty project. We have to have a panic handler t compile. We can add it by a crate easily. It is panic-halt. It will a panic handler as infinite loop. We will add it by <code>cargo add panic-halt</code> to project then add one line to our code like: <code>use panic-halt as _:</code></blockquote><blockquote><p>Now rust analyzer and cargo check both are happy.</blockquote><blockquote><p>Now we need our tools for embedded. We call <code>rustup component add llvm-tools</code> to add llvm tools for size, binary file details and dissambly tools. Then we call <code>cargo install cargo-binutils</code> as wrapper for llvm-tools to make it easy to use.</blockquote><blockquote><p>Now we can check size by <code>cargo size -- -Ax</code>. It will show all details about application sections and size.</blockquote><blockquote><p>To flash it, we need one more tool. <code>cargo install cargo-embed</code></blockquote><blockquote><p>Then we can call <code>cargo embed --help</code> to see guide. By <code>cargo embed --list-chips</code>. It is a huge list. We can filter for our chip by <code>cargo embed --list-chips | grep -i nrf52833</code></blockquote><blockquote><p>Now we can embed it by <code>cargo embed --chip nRF52833_xxAA</code></blockquote><hr><blockquote><p>For using this details in next time we will add <code>Embed.toml</code> file to our project.</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>[default.general]
</span><span>chip = "nRF52833_xxAA"
</span></code></pre><blockquote><p>Now we can embed it by <code>cargo embed</code>. We need debugger. The crate for it is <code>rtt-target</code>. (It will require <code>critical-section</code> so we will add crate <code>cortex-m</code>). We call <code>cargo add cortex-m</code> and <code>cargo add rtt-target</code></blockquote><blockquote><p>To enable it need to add it to our <code>Embed.toml</code> file as below.</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>[default.general]
</span><span>chip = "nRF52833_xxAA"
</span><span>
</span><span>[default.rtt]
</span><span>enabled = true
</span></code></pre><blockquote><p>It is so easy to use. We init in the entry of main. Then we call <code>rprintln!</code> like below.</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>#![no_std]
</span><span>#![no_main]
</span><span>
</span><span>use cortex_m::asm::nop;
</span><span>use cortex_m_tr::entry;
</span><span>use panic-halt as _:
</span><span>use rtt_target::{rprintln, rtt_init_print}
</span><span>
</span><span>#[entry]
</span><span>fn main() -> !{
</span><span>    rtt_init_print!();
</span><span>    rprintln!("Hello rusty");
</span><span>    loop{
</span><span>        rprintln!("loopy");
</span><span>        for _ in 0..100_000{
</span><span>            nop();
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><blockquote><p>Now we need debugging like a pro. With breakpoints, with memory check and touch. We go with <code>gdb</code> like for last 30 years. In linux we install by <code>sudo apt-get install gdb-nultiarch</code> In windows we download from arm-gnu-toolchain-downloads from arm website.</blockquote><blockquote><p>To enable gdb we will update our Embed.toml file as below:</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>[default.general]
</span><span>chip = "nRF52833_xxAA"
</span><span>
</span><span>[default.rtt]
</span><span>enabled = false
</span><span>
</span><span>[default.gdb]
</span><span>enabled = true
</span><span>
</span><span>[enabled.reset]
</span><span>halt_aferwards = true
</span></code></pre><blockquote><p>We closed rtt, and will change the code to increment a variable value and watch. It will be as below:</blockquote><pre style=background:#2b303b;color:#c0c5ce><code><span>#![no_std]
</span><span>#![no_main]
</span><span>
</span><span>use cortex_m::asm::nop;
</span><span>use cortex_m_tr::entry;
</span><span>use panic_halt as _;
</span><span>
</span><span>#[entry]
</span><span>fn main() -> !{
</span><span>    let mut x: usize = 0;
</span><span>    loop{
</span><span>        x += 1;
</span><span>        for _ in 0..x{
</span><span>            nop();
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><blockquote><p>we will run embed in one terminal and run gdb in another terminal. We will run gdb by <code>arm-none-eabi-gdb target/thumbv7...</code>. We will give target binary location in this.</blockquote><blockquote><p>then it will run. We will connect to our device by <code>target remote : 1337</code></blockquote><blockquote><p>we can check out register values by <code>info registers</code>. It will list R0 to R12 with other registers.</blockquote><blockquote></blockquote></div></div></div></main><footer class="max-w-7xl mx-auto relative pt-1 px-2 border-b-2 border-gray-300 dark:border-gray-200 w-full"><div class="mt-16 border-t-2 border-gray-300 flex flex-col items-center"><div class="sm:w-2/3 text-center py-6"><p class="text-sm text-black dark:text-white font-bold mb-2">© 2022 blow theme made with <a href=https://tailwindcss.com/ target=_blank>tailwindcss</a> for <a href=https://www.getzola.org/ target=_blank>Zola</a></div></div></footer><script defer src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js></script><script src=/search_index.en.js></script><script defer src=/js/search.js></script><script defer src=/js/lang.js></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=myclientid" async crossorigin></script><script defer src=/js/page.js></script>